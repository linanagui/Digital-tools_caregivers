---
title: "NHATS_caregiver_datasets"
output: html_document
date: "2025-03-12"
---

```{r}
# Install necessary packages (run once)
install.packages(c("haven", "tidyverse", "janitor", "skimr"))

# Load libraries
library(haven)      # To read .sas7bdat files
library(tidyverse)  # For data wrangling
library(janitor)    # For cleaning column names
library(skimr)      # For summarizing datasets

# Load NHATS data files
nhats_sp <- read_sas("~/desktop/NHATS_R13_Final_Release_SAS/SP_files/NHATS_Round_13_SP_File.sas7bdat") # Sample Person Data
nhats_op <- read_sas("~/desktop/NHATS_R13_Final_Release_SAS/OP_files/NHATS_Round_13_OP_File.sas7bdat") # Caregiver Data
nhats_tab <- read_sas("~/desktop/NHATS_R13_Final_Release_SAS/Tab_files/NHATS_Round_13_Tab_Act_File.sas7bdat") # Digital tool use data
inc_path <- read_sas("~/desktop/NHATS_R13_Final_Release_SAS/Inc_files/NHATS_R13_Int_Inc_Imp_File.sas7bdat")

# Clean column names
nhats_sp <- nhats_sp %>% clean_names()
nhats_op <- nhats_op %>% clean_names()
nhats_tab <- nhats_tab %>% clean_names()
nhats_inc <- inc_path %>% clean_names()  # Income & Socioeconomic Data

# Check variables
colnames(nhats_sp)
colnames(nhats_op)
colnames(nhats_tab)
colnames(nhats_inc)
```


Select Key NHATS Variables for Readmission & Caregiving Analysis

We extract caregiver involvement, digital tool use, and chronic disease status.

```{r}
# nhats_filtered <- nhats_sp %>%
#   select(
#     spid,                   # Unique respondent ID
#     r13dresid,              # Residential status (home, assisted living, nursing home)
#     #r13proxy,               # Whether a proxy answered (suggests severe disability)
#     hc13disescn1,           # Heart Attack
#     hc13disescn2,           # Heart Disease
#     hc13disescn3,           # High Blood Pressure
#     hc13disescn4,           # Arthritis
#     hc13disescn5,           # Osteoporosis
#     rh13rehabcond,          # Main medical condition for rehab (stroke, joint replacement, COPD, etc.)
#     r13dgender,             # Gender
#     r13d2intvrage,          # Age category
#     #r13income,              # Income
#     #r13educ,                # Education level
#     #r13marital,             # Marital status
#     #r13children             # Number of children (potential caregivers)
#   )
# 
# # Check summary
# summary(nhats_filtered)
```

```{r}
# Select relevant variables from NHATS_SP (Older Adults Data)
nhats_sp_filtered <- nhats_sp %>%
  select(
    spid,              # Unique respondent ID
    r13dresid,         # Residential status (community, assisted living, nursing home)
    r13dgender,        # Gender of respondent
    r13d2intvrage,     # Age of respondent
    hc13disescn1, hc13disescn2, hc13disescn3, hc13disescn4, hc13disescn5, 
    hc13disescn6, hc13disescn7, hc13disescn8, hc13disescn9, hc13disescn10,  # Chronic diseases
    is13proxlivsp,     # Does caregiver live with respondent?
    is13prxyrelat,     # Relationship of the proxy caregiver
    is13prxygendr,     # Gender of the proxy caregiver
    em13paydevce1:em13paydevce6  # Assistive technology usage
  )

# Select relevant variables from NHATS_OP (Caregivers Data)
nhats_op_filtered <- nhats_op %>%
  select(
    spid,             # Unique respondent ID (for merging)
    op13relatnshp,    # Relationship of caregiver to respondent
    op13proxy,        # Whether caregiver answered on behalf of respondent
    op13dage,         # Age of the caregiver
    #op13prxygendr,    # Gender of the caregiver
    op13numhrsday,    # Hours of caregiving per day
    op13numdayswk     # Days of caregiving per week
  )

# Select relevant variables from NHATS_Tab (Tablet/Digital Tool Usage)
nhats_tab_filtered <- nhats_tab %>%
  select(
    spid,              # Unique respondent ID (for merging)
    vh13vision,        # Vision impairment
    vh13hearing        # Hearing impairment
  )

# Select relevant variables from NHATS_Inc (Income & Socioeconomic Data)
nhats_inc_filtered <- nhats_inc %>%
  select(
    spid,              # Unique respondent ID (for merging)
    ia13toincimif     # Imputed total income
  )
```



Merge Caregiver & Digital Tool Use Data

Merge NHATS caregiving data with digital tool usage

```{r}
# Merge NHATS_SP with NHATS_OP (Caregiver + Care Recipient Data)
nhats_merged <- nhats_sp_filtered %>%
  left_join(nhats_op_filtered, by = "spid") %>%
  left_join(nhats_tab_filtered, by = "spid") %>%
  left_join(nhats_inc_filtered, by = "spid")

# Check merged dataset
glimpse(nhats_merged)
```

Handle Missing Values
NHATS datasets use special codes (-9, -1) for missing values, which we replace with NA.
```{r}
# Replace missing values (-9 and -1) with NA
nhats_cleaned <- nhats_merged %>%
  mutate(across(everything(), ~ na_if(.x, -9))) %>%
  mutate(across(everything(), ~ na_if(.x, -1)))

# Check missing values summary
colSums(is.na(nhats_cleaned))
```



Now, we have caregiver data linked to NHATS participantsâ€™ chronic conditions and digital tool use.


Save the Cleaned & Merged Dataset
```{r}
# Save as CSV
write_csv(nhats_cleaned, "NHATS_Cleaned_Caregivers_DigitalTools.csv")

# Save as RData for easy reloading
save(nhats_cleaned, file = "NHATS_Cleaned_Caregivers_DigitalTools.RData")
```

